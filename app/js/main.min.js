function start(){start1=performance.now(),loop=window.requestAnimationFrame(start),counter%gameSpeed==0&&game(),counter++}function game(){update(),render()}function update(){bgpos-=speed,-width>=bgpos&&(bgpos=0);for(i in enemies)enemies[i].x-=speed,enemies[i].x<-510&&enemies.splice(i,1);counter%50==0&&enemies.push(new enemy);for(i in bullets)vB=22,vBx=vB*Math.cos(bullets[i].angle),vBy=vB*Math.sin(bullets[i].angle),bullets[i].x+=vBx,bullets[i].y+=vBy;keys[37]&&!gameIsOver&&(player.x-=5,findMouseAngle()),keys[39]&&!gameIsOver&&(player.x+=5,findMouseAngle()),keys[38]&&!gameIsOver&&(player.y-=5,findMouseAngle()),keys[40]&&!gameIsOver&&(player.y+=5,findMouseAngle()),player.x<0&&(player.x=0),player.y<=25&&(player.y=25),player.x>=width-player.width&&(player.x=width-player.width),player.y>=height-player.height-50&&(player.y=height-player.height-50)}function render(){context.clearRect(0,0,width,height),context.fillRect(0,0,width,25),context.fillRect(player.x,player.y,player.width,player.height),context.save(),context.translate(player.x,player.y),context.rotate(player.hand.rotation*Math.PI/180),context.fillStyle="red",context.globalAlpha=.1,context.fillRect(0,-1,2500,1),context.fillRect(0,1,2500,1),context.globalAlpha=.5,context.fillRect(0,0,2500,1),context.globalAlpha=1,context.fillStyle="cyan",context.fillRect(0,0,50,4),context.fillStyle="black",context.restore(),context.fillRect(0,height-50,width,50);for(i in enemies){var e=enemies[i];context.fillRect(e.x,e.y,e.width,e.height)}for(i in bullets){var t=bullets[i];context.fillRect(t.x,t.y,t.width,t.height)}}function initImages(e){requiredImages=e.length;for(i in e){console.log(e[i]);var t=new Image;t.src="/image/"+e[i],images[i]=t,images[i].onload=function(){doneImages++,console.log(doneImages)}}}function findMouseAngle(){deltaX=mouseX-10-player.x,deltaY=mouseY-10-player.y,player.hand.rotation=180/Math.PI*Math.atan2(deltaY,deltaX),console.log("searching")}function shoot(){bullets.push(new bullet(player.x,player.y))}function collision(e,t){return!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y)}var canvas=document.getElementById("context"),context=canvas.getContext("2d"),width=1e3,height=700;canvas.width=width,canvas.height=height,canvas.style.width=canvas.width+"px",canvas.style.height=canvas.height+"px",window.addEventListener("keydown",function(e){keys[e.keyCode]=!0},!1),window.addEventListener("keyup",function(e){delete keys[e.keyCode]},!1),window.addEventListener("mousemove",function(e){mouseX=event.clientX,mouseY=event.clientY,findMouseAngle()},!1),window.addEventListener("click",function(e){shoot(),console.log(bullets)},!1);var loop,counter=0,gameIsOver=!1,enemies=[],bullets=[],gameSpeed=1,keys=[],bgpos=0,deltaX,deltaY,speed=5,images=[],requiredImages=0,mouseX,mouseY,doneImages=0,vB,vBx,vBy,player={width:20,height:20,y:100,x:50,hand:{rotation:0}},enemy=function(){this.x=width+100*Math.random(),this.y=25+50*Math.floor(12*Math.random()),this.width=24,this.height=50},bullet=function(e,t){this.x=e,this.y=t,this.width=3,this.height=3,this.angle=player.hand.rotation*Math.PI/180,this.deltaX=deltaX,this.rikoshet=0},start1;findMouseAngle(),start();